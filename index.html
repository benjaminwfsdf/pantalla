<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>Clock · Weather · Aura Pro</title>
<meta name="theme-color" content="#0a0f14"/>

<!-- Tipografías -->
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Kalnia:wght@600&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#0a0f14; --bg2:#0e1620;
    --ink:#eaf2ff; --muted:#a3b2c9;
    --glass:rgba(10,16,24,.55); --glass2:rgba(10,16,24,.78);
    --card:#0f1824; --stroke:rgba(255,255,255,.10);
    --accent:#5b8ecf; --ok:#22c55e; --warn:#f59e0b; --danger:#ef4444;
    --r:22px; --shadow:0 24px 70px rgba(0,0,0,.45);
    --kenburns: 38s;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--ink);
    background: radial-gradient(1200px 800px at 10% 10%, #0f2238 0%, transparent 60%),
                radial-gradient(1200px 800px at 90% 10%, #16243a 0%, transparent 60%),
                linear-gradient(180deg,var(--bg),var(--bg2));
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    overflow:hidden; cursor:default;
  }

  /* AURA animada */
  .aura{
    position:fixed; inset:-15vmax; z-index:0; pointer-events:none; filter:saturate(1.05);
    background:
      radial-gradient(50vmax 50vmax at 15% 25%, rgba(91,142,207,.18), transparent 60%),
      radial-gradient(55vmax 55vmax at 85% 15%, rgba(255,42,32,.10), transparent 62%),
      radial-gradient(60vmax 60vmax at 80% 85%, rgba(35,197,94,.10), transparent 65%),
      radial-gradient(55vmax 55vmax at 18% 80%, rgba(255,188,73,.10), transparent 65%);
    animation: hue 28s ease-in-out infinite alternate;
  }
  @keyframes hue{
    0%{filter:hue-rotate(0deg) blur(0px)}
    50%{filter:hue-rotate(14deg) blur(1px)}
    100%{filter:hue-rotate(28deg) blur(0px)}
  }

  /* Fondo slideshow (Ken Burns) */
  .stage{ position:fixed; inset:0; z-index:-1; overflow:hidden; }
  .slide{
    position:absolute; inset:-2%; background:center/cover no-repeat;
    opacity:0; transform: scale(1.05);
    transition: opacity 1.2s ease, transform var(--kenburns) ease;
    filter: brightness(.85) saturate(1.05);
    will-change:opacity,transform;
  }
  .slide.show{ opacity:1; transform: scale(1.15) }

  /* Layout */
  .wrap{
    height:100%; display:grid; align-items:center; justify-items:center; padding:3vmin;
  }
  .panel{
    width:min(1200px,96vw);
    background:linear-gradient(180deg,var(--glass),var(--glass2));
    border:1px solid var(--stroke);
    border-radius:var(--r); box-shadow:var(--shadow);
    padding:26px 26px 18px; backdrop-filter: blur(7px);
  }
  .top{
    display:grid; grid-template-columns:1fr auto; gap:14px; align-items:center;
    margin-bottom:12px;
  }
  .loc{font-weight:700; letter-spacing:.35px}
  .status{display:flex; align-items:center; gap:10px; color:var(--muted); font-size:14px}
  .dot{width:10px;height:10px;border-radius:50%;background:#6b7280}
  .dot.live{background:var(--ok); box-shadow:0 0 0 3px rgba(34,197,94,.22)}

  .grid{
    display:grid; gap:20px;
    grid-template-columns: 1.4fr 1fr;
  }
  @media (max-width: 980px){ .grid{ grid-template-columns:1fr } }

  /* Reloj */
  .clock{ display:flex; flex-direction:column; gap:6px }
  .time{
    font-size: clamp(58px, 11vw, 132px);
    line-height:1; font-weight:800; letter-spacing:1.5px;
  }
  .time .sec{ opacity:.5; font-weight:600; font-size:.46em; margin-left:.25em }
  .date{ font-size: clamp(16px,2.4vw,22px); color:var(--muted) }

  /* Clima */
  .card{ background:var(--card); border:1px solid var(--stroke); border-radius:16px; padding:16px }
  .card h3{ margin:0 0 10px; font-size:16px; color:#dbe9ff; letter-spacing:.3px; font-weight:600 }
  .wx-now{ display:flex; align-items:center; gap:14px }
  .wx-temp{ font-size: clamp(38px, 6.4vw, 62px); font-weight:800; letter-spacing:.3px }
  .wx-desc{ color:#d6e3fb }
  .wx-icon{ font-size:34px; line-height:1.1; opacity:.95 }
  .wx-grid{ display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin-top:10px }
  .wx-box{ background:#0b121a; border:1px solid var(--stroke); border-radius:12px; padding:10px }
  .k{font-size:12px; color:#a3b2c9} .v{font-weight:700}

  /* Footer + controles */
  .foot{ display:flex; justify-content:flex-end; align-items:center; gap:12px; margin-top:12px; color:var(--muted); font-size:13px; flex-wrap:wrap }
  .controls{ display:flex; gap:8px; flex-wrap:wrap }
  .btn{
    appearance:none; border:1px solid var(--stroke); background:#0f1622; color:var(--ink);
    padding:12px 14px; border-radius:14px; font-weight:800; cursor:pointer;
    transition:.15s transform,.2s box-shadow; font-size:16px; min-width:180px;
  }
  .btn:hover, .btn:focus{ box-shadow:0 0 0 2px rgba(91,142,207,.28) inset; outline:none }
  .btn:active{ transform:translateY(1px) }

  /* Panel de ajustes */
  .settings{
    position:fixed; right:18px; bottom:18px; width:360px; max-width:calc(100vw - 36px);
    background:linear-gradient(180deg,var(--glass),var(--glass2));
    border:1px solid var(--stroke); border-radius:16px; box-shadow:var(--shadow);
    padding:14px; display:none; backdrop-filter: blur(7px); z-index:10;
  }
  .settings.show{ display:block }
  .set-row{ display:grid; grid-template-columns:1fr auto; align-items:center; gap:10px; padding:6px 2px }
  .set-row input[type="range"]{ width:180px }
  .seg{ font-size:12px; color:var(--muted); margin-top:2px }
  .select, .toggle{
    background:#0f1622; border:1px solid var(--stroke); color:var(--ink); border-radius:10px; padding:8px 10px; font-weight:700;
  }

  /* Temas */
  .theme-neon{ --accent:#ff2a20; --bg:#080b0f; --bg2:#0b0f14 }
  .theme-warm{ --accent:#ffbc49; --bg:#0c0a08; --bg2:#16110a }
</style>
</head>
<body>
  <div class="aura"></div>

  <!-- Fondo slideshow -->
  <div class="stage" aria-hidden="true">
    <div id="s0" class="slide"></div>
    <div id="s1" class="slide"></div>
  </div>

  <main class="wrap">
    <section class="panel" role="region" aria-label="Reloj y clima">
      <header class="top">
        <div class="loc" id="loc">Lo Prado, Santiago</div>
        <div class="status" aria-live="polite">
          <span class="dot" id="dot"></span>
          <span id="stat">Cargando clima…</span>
        </div>
      </header>

      <div class="grid">
        <!-- Reloj -->
        <section class="clock" aria-label="Hora y fecha">
          <div class="time" id="hora">--:--<span class="sec">--</span></div>
          <div class="date" id="fecha">—</div>
        </section>

        <!-- Clima -->
        <aside class="card" aria-label="Clima actual">
          <h3>Clima</h3>
          <div class="wx-now">
            <div class="wx-temp"><span id="tActual">--</span>°</div>
            <div class="wx-desc">
              <div id="wxText">—</div>
              <div class="wx-icon" id="wxEmoji" aria-hidden="true">—</div>
            </div>
          </div>
          <div class="wx-grid">
            <div class="wx-box"><div class="k">Mín</div><div class="v" id="tMin">--°</div></div>
            <div class="wx-box"><div class="k">Máx</div><div class="v" id="tMax">--°</div></div>
            <div class="wx-box"><div class="k">Viento</div><div class="v" id="viento">-- km/h</div></div>
          </div>
        </aside>
      </div>

      <footer class="foot">
        <div class="controls">
          <button class="btn" id="btnPause" tabindex="0">⏯ Pausa / Reanudar</button>
          <button class="btn" id="btnNext" tabindex="0">→ Siguiente fondo</button>
          <button class="btn" id="btnFull" tabindex="0">⛶ Pantalla completa</button>
          <button class="btn" id="btnSettings" tabindex="0">⚙️ Ajustes</button>
        </div>
      </footer>
    </section>
  </main>

  <!-- Panel de ajustes -->
  <aside class="settings" id="settings" role="dialog" aria-label="Ajustes">
    <!-- ajustes igual que antes -->
  </aside>

<script>
/* ========================== CONFIG ========================== */
const MY_PICS = [
  "imagenes/max.jpg",
  "imagenes/max_auto.jpg"
];
const IMAGE_SET = Object.fromEntries(
  ["day_clear","day_cloudy","rain","night_clear","night_cloudy"].map(k => [k, MY_PICS])
);
const SLIDE_MS = 28_000;
/* ============================================================ */

const $ = s => document.querySelector(s);
const pad = n => String(n).padStart(2,'0');
const params = new URLSearchParams(location.search);

/* -------- Slideshow -------- */
let slideTimer=null, paused=false, slideIdx=0, active=0, pool=IMAGE_SET.day_clear;
const slides=[$("#s0"),$("#s1")];
function setSlide(url){
  const next=1-active;
  slides[next].style.backgroundImage=`url('${url}')`;
  slides[next].classList.add('show');
  slides[active].classList.remove('show');
  active = next;
}
function nextSlide(force=false){
  if(paused && !force) return;
  slideIdx=(slideIdx+1)%pool.length;
  setSlide(pool[slideIdx]);
}
function startShow(){ clearInterval(slideTimer); slideTimer=setInterval(nextSlide, SLIDE_MS); }
function choosePool(){ return IMAGE_SET.day_clear; }

/* -------- Reloj -------- */
let hourFormat = localStorage.getItem("hourFormat") || "24";
function tick(){
  const d=new Date();
  let h=d.getHours(), ampm="";
  if(hourFormat==="12"){ ampm = h>=12?"PM":"AM"; h = (h%12)||12; }
  $("#hora").innerHTML = `${pad(h)}:${pad(d.getMinutes())}<span class="sec">${pad(d.getSeconds())}${ampm?(" "+ampm):""}</span>`;
  const dias=["domingo","lunes","martes","miércoles","jueves","viernes","sábado"];
  const meses=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"];
  $("#fecha").textContent = `${dias[d.getDay()]}, ${d.getDate()} de ${meses[d.getMonth()]}`;
  setTimeout(tick, 1000);
}
tick();

/* -------- Clima -------- */
async function cargarClima(){
  $("#loc").textContent = "Lo Prado, Santiago";
  const url = "https://api.open-meteo.com/v1/forecast?latitude=-33.45&longitude=-70.72&current=temperature_2m,wind_speed_10m,weather_code&daily=temperature_2m_max,temperature_2m_min,weather_code&timezone=auto";
  try{
    const r = await fetch(url, {cache:"no-store"});
    const d = await r.json();
    const now=d.current;
    $("#tActual").textContent = now.temperature_2m;
    $("#viento").textContent = Math.round(now.wind_speed_10m) + " km/h";
    $("#tMin").textContent = d.daily.temperature_2m_min[0] + "°C";
    $("#tMax").textContent = d.daily.temperature_2m_max[0] + "°C";
    $("#wxText").textContent = "Despejado";
    $("#wxEmoji").textContent = "☀️";
    $("#stat").textContent = "Clima actualizado";
    $("#dot").classList.add("live");
    slideIdx=0; setSlide(pool[slideIdx]);
  }catch(e){
    $("#stat").textContent="Clima no disponible";
    $("#dot").classList.remove("live");
  }finally{
    setTimeout(cargarClima, 15*60*1000);
  }
}
cargarClima();
startShow();
</script>
</body>
</html>
